<!--
  InventCount - Ê£öÂç∏„ÅóPWA
  Author: t.miyata
  https://note.com/nice_camel539
-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <title>InventCount - Ê£öÂç∏„ÅóPWA</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007AFF">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="InventCount">
  <link rel="icon" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; margin:0; background:#f5f5f5; overflow-x: hidden; -webkit-user-select: none; user-select: none;}
    .container { max-width: 540px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; padding-bottom: 80px;}
    .header { background: linear-gradient(135deg, #007AFF 0%, #0056b3 100%); color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1);}
    .header h1 { margin: 0; font-size: 24px; font-weight: 600;}
    .session-info { font-size: 14px; margin-top: 8px; opacity: 0.9;}
    .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; margin-top: 8px; overflow: hidden;}
    .progress-fill { height: 100%; background: #28a745; width: 0%; transition: width 0.3s ease;}
    nav { display: flex; background: white; border-bottom: 1px solid #eee; overflow-x: auto; -webkit-overflow-scrolling: touch;}
    nav button { flex: 1; min-width: 80px; padding: 16px 8px; font-size: 14px; border: none; background: white; color: #666; font-weight: 500; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s ease; white-space: nowrap;}
    nav button.active { color: #007AFF; border-bottom-color: #007AFF; background: #f8f9fa;}
    nav button:hover { background: #f8f9fa; }
    section { display: none; padding: 20px; animation: fadeIn 0.3s ease;}
    section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .field { margin: 16px 0;}
    label { display: block; margin-bottom: 8px; font-weight: 500; color: #333;}
    input[type="number"], select, input[type="text"], input[type="file"] { width: 100%; padding: 16px; font-size: 18px; border-radius: 12px; border: 2px solid #e1e5e9; background: white; transition: all 0.2s ease; -webkit-appearance: none; color: #222;}
    input:focus, select:focus { outline: none; border-color: #007AFF; box-shadow: 0 0 0 3px rgba(0,122,255,0.1);}
    button { border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; min-height: 44px; display: inline-flex; align-items: center; justify-content: center; text-decoration: none;}
    button:disabled { background: #ccc !important; cursor: not-allowed; opacity: 0.6;}
    button:active { transform: scale(0.98); }
    #scan-btn { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px 32px; font-size: 20px; margin: 8px 0 8px 0; min-height: 56px; width: 100%; box-shadow: 0 4px 15px rgba(40,167,69,0.3);}
    #scan-btn:hover { box-shadow: 0 6px 20px rgba(40,167,69,0.4); transform: translateY(-2px);}
    #add-btn { background: linear-gradient(135deg, #007AFF 0%, #0056b3 100%); color: white; padding: 16px 32px; font-size: 18px; margin: 8px 0 8px 0; min-height: 56px; width: 100%; box-shadow: 0 3px 12px rgba(0,122,255,0.3);}
    button.secondary { background: #6c757d; color: white; padding: 12px 24px; min-height: 48px;}
    button.danger { background: #dc3545; color: white; padding: 12px 24px; min-height: 48px;}
    button.success { background: #28a745; color: white; padding: 12px 24px; min-height: 48px;}
    .unit-btns { display: flex; gap: 8px; margin-top: 8px;}
    .unit-btn { flex: 1; padding: 12px; background: #f8f9fa; color: #333; border: 2px solid #e1e5e9; min-height: 48px; font-weight: bold;}
    .unit-btn.active { background: #007AFF; color: white; border-color: #007AFF;}
    .product-name-display { margin-top: 12px; padding: 16px; border-radius: 12px; font-weight: 600; font-size: 16px; display: none; animation: slideIn 0.3s ease;}
    .product-name-display.show { display: block;}
    .product-name-display.success { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 2px solid #28a745; color: #155724;}
    .product-name-display.error { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); border: 2px solid #dc3545; color: #721c24;}
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; margin: 16px 0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    table { width: 100%; border-collapse: collapse; font-size: 14px; background: white;}
    th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #eee;}
    th { background: #f8f9fa; font-weight: 600; color: #495057; position: sticky; top: 0;}
    tr:hover { background: #f8f9fa; }
    .actions button { font-size: 12px; padding: 6px 12px; min-height: 32px; margin: 2px;}
    .toast { position: fixed; left: 50%; bottom: 100px; transform: translateX(-50%); background: #333; color: #fff; padding: 16px 24px; border-radius: 12px; z-index: 9999; font-size: 16px; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: toastIn 0.3s ease;}
    .toast.success { background: #28a745; }
    .toast.error { background: #dc3545; }
    @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
    .footer { position: absolute; bottom: 0; left: 0; right: 0; text-align: center; color: #aaa; font-size: 12px; padding: 16px; background: #f8f9fa; border-top: 1px solid #eee;}
    #version-info { font-size: 11px; color: #666; margin-bottom: 4px; cursor: pointer; transition: color 0.2s ease;}
    #version-info:hover { color: #007AFF; }
    @media (max-width: 480px) { .container { padding-bottom: 60px; } .header { padding: 16px; } .header h1 { font-size: 20px; } section { padding: 16px; } nav button { padding: 12px 6px; font-size: 12px; } #scan-btn { font-size: 18px; min-height: 48px; } #add-btn { font-size: 16px; min-height: 48px; } }
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-16 { margin-top: 16px; }
    .mb-16 { margin-bottom: 16px; }
    .loading { opacity: 0.6; pointer-events: none;}
    .scan-success { animation: scanSuccess 0.5s ease-in-out;}
    @keyframes scanSuccess { 0% { transform: scale(1); } 50% { transform: scale(1.05); background: #28a745; } 100% { transform: scale(1); } }
    #jan.scan-success { background: #fff3cd; border-color: #ffc107; transition: background 0.3s, border-color 0.3s;}
    /* „Ç´„É°„É©„É¢„Éº„ÉÄ„É´Áî® */
    .camera-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #reader-modal {
      width: 90vw;
      max-width: 400px;
      height: 60vw;
      max-height: 400px;
      background: #000;
      border-radius: 16px;
      overflow: hidden;
    }
    .cancel-modal-btn {
      margin-top: 16px;
      background: #dc3545;
      color: #fff;
      font-size: 18px;
      padding: 12px 32px;
      border-radius: 12px;
      border: none;
    }
    @media (max-width: 480px) {
      #reader-modal { width: 98vw; height: 60vw; max-width: 99vw; max-height: 70vw; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üì¶ InventCount</h1>
      <div class="session-info" id="session-info">ÈÄ£Á∂öÁôªÈå≤„É¢„Éº„Éâ‰∏≠Ôºö0‰ª∂ÁôªÈå≤Ê∏à„Åø</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>
    <nav>
      <button id="nav-register" class="active">üì± ÁôªÈå≤</button>
      <button id="nav-edit">‚úèÔ∏è ‰øÆÊ≠£</button>
      <button id="nav-export">üìä Âá∫Âäõ</button>
      <button id="nav-delete">üóëÔ∏è ÂâäÈô§</button>
      <button id="nav-master">üìã „Éû„Çπ„Çø</button>
    </nav>
    <section id="section-register" class="active">
      <div class="field">
        <label>üè∑Ô∏è JAN„Ç≥„Éº„Éâ</label>
        <input type="text" id="jan" inputmode="numeric" pattern="[0-9]*" maxlength="13" autocomplete="off" placeholder="JAN„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åæ„Åü„ÅØ„Çπ„Ç≠„É£„É≥">
        <div id="product-name" class="product-name-display"></div>
      </div>
      <!-- „Ç´„É°„É©„ÅßË™≠„ÅøÂèñ„Çä„Éú„Çø„É≥ -->
      <button id="scan-btn" type="button">üì∑ „Ç´„É°„É©„ÅßË™≠„ÅøÂèñ„Çä</button>
      <div class="field">
        <label>üî¢ Êï∞Èáè</label>
        <input type="number" id="qty" min="1" value="1" inputmode="numeric">
      </div>
      <div class="field">
        <label>üì¶ Âçò‰Ωç</label>
        <div class="unit-btns">
          <button type="button" class="unit-btn active" data-unit="ÂÄã">ÂÄã</button>
          <button type="button" class="unit-btn" data-unit="ÁÆ±">ÁÆ±</button>
          <button type="button" class="unit-btn" data-unit="Áî≤">Áî≤</button>
        </div>
        <input type="hidden" id="unit" value="ÂÄã">
      </div>
      <!-- ÁôªÈå≤„Éú„Çø„É≥„Çí‰∏ÄÁï™‰∏ã„Å´ -->
      <button id="add-btn" type="button">‚úÖ ÁôªÈå≤</button>
      <div class="mt-16">
        <h3>üìã ÁôªÈå≤Ê∏à„Åø‰∏ÄË¶ß</h3>
        <div class="table-container">
          <table id="list-table">
            <thead>
              <tr>
                <th>No</th><th>JAN</th><th>ÂïÜÂìÅÂêç</th><th>Êï∞Èáè</th><th>Âçò‰Ωç</th><th>Êó•ÊôÇ</th><th>Êìç‰Ωú</th>
              </tr>
            </thead>
            <tbody id="list-body"></tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="section-edit">
      <h3>‚úèÔ∏è ÁôªÈå≤„Éá„Éº„Çø‰øÆÊ≠£</h3>
      <div class="table-container">
        <table id="edit-table">
          <thead>
            <tr>
              <th>No</th><th>JAN</th><th>ÂïÜÂìÅÂêç</th><th>Êï∞Èáè</th><th>Âçò‰Ωç</th><th>Êó•ÊôÇ</th><th>Á∑®ÈõÜ</th>
            </tr>
          </thead>
          <tbody id="edit-body"></tbody>
        </table>
      </div>
      <div id="edit-form-area" class="hidden mt-16">
        <h4>üìù ‰øÆÊ≠£ÂÜÖÂÆπ</h4>
        <div class="field">
          <label>Êï∞Èáè</label>
          <input type="number" id="edit-qty" min="1">
        </div>
        <div class="field">
          <label>Âçò‰Ωç</label>
          <select id="edit-unit">
            <option value="ÂÄã">ÂÄã</option>
            <option value="ÁÆ±">ÁÆ±</option>
            <option value="Áî≤">Áî≤</option>
          </select>
        </div>
        <button id="edit-save-btn" class="success">‚úÖ Á¢∫ÂÆö</button>
        <button id="edit-cancel-btn" class="secondary">‚ùå „Ç≠„É£„É≥„Çª„É´</button>
      </div>
    </section>
    <section id="section-export">
      <h3>üìä „Éá„Éº„ÇøÂá∫Âäõ</h3>
      <div class="field">
        <label>Âá∫ÂäõÂΩ¢Âºè</label>
        <select id="export-type">
          <option value="csv">CSVÂΩ¢Âºè</option>
        </select>
      </div>
      <div class="field">
        <label>Âá∫ÂäõÂæå„ÅÆ„Éá„Éº„ÇøÂá¶ÁêÜ</label>
        <select id="export-after">
          <option value="keep">„Éá„Éº„Çø„Çí‰øùÊåÅ</option>
          <option value="delete">„Éá„Éº„Çø„ÇíÂâäÈô§</option>
        </select>
      </div>
      <button id="export-btn" class="success">üì• Âá∫ÂäõÂÆüË°å</button>
    </section>
    <section id="section-delete">
      <h3>üóëÔ∏è „Éá„Éº„ÇøÂâäÈô§</h3>
      <div class="field">
        <label>ÂâäÈô§ÊñπÊ≥ï</label>
        <select id="delete-type">
          <option value="all">ÂÖ®‰ª∂ÂâäÈô§</option>
          <option value="select">ÈÅ∏ÊäûÂâäÈô§</option>
        </select>
      </div>
      <div class="table-container hidden" id="delete-select-area">
        <table id="delete-table">
          <thead>
            <tr>
              <th>ÈÅ∏Êäû</th><th>No</th><th>JAN</th><th>ÂïÜÂìÅÂêç</th><th>Êï∞Èáè</th><th>Âçò‰Ωç</th><th>Êó•ÊôÇ</th>
            </tr>
          </thead>
          <tbody id="delete-body"></tbody>
        </table>
      </div>
      <button id="delete-btn" class="danger">üóëÔ∏è ÂâäÈô§ÂÆüË°å</button>
    </section>
    <section id="section-master">
      <h3>üìã ÂïÜÂìÅ„Éû„Çπ„ÇøÂèñËæº</h3>
      <div class="field">
        <label>CSV„Éï„Ç°„Ç§„É´ÈÅ∏Êäû</label>
        <input type="file" id="master-file" accept=".csv">
        <small>„Éï„Ç©„Éº„Éû„ÉÉ„Éà: JAN„Ç≥„Éº„Éâ,ÂïÜÂìÅÂêç,Âçò‰æ°,„Ç´„ÉÜ„Ç¥„É™,ÂÇôËÄÉ</small>
      </div>
      <button id="master-import-btn" class="success">üì• ÂèñËæºÂÆüË°å</button>
      <button id="master-cancel-btn" class="secondary">‚ùå „Ç≠„É£„É≥„Çª„É´</button>
      <div id="master-result" class="mt-16"></div>
    </section>
    <div class="footer">
      <div id="version-info">InventCount v1.0.0</div>
      &copy; 2025 InventCount PWA<br>
      <a href="https://seiumiyata.github.io/invent/">GitHub Pages</a><br>
      <span style="font-size:10px; color:#bbb;">Author: t.miyata</span>
    </div>
    <div class="toast" id="toast"></div>
  </div>
  <!-- „Ç´„É°„É©„É¢„Éº„ÉÄ„É´ -->
  <div id="camera-modal" class="camera-modal hidden">
    <div id="reader-modal"></div>
    <button id="cancel-scan-modal-btn" class="cancel-modal-btn">üì∑ „Çπ„Ç≠„É£„É≥ÂÅúÊ≠¢</button>
  </div>
  <audio id="audio-ok" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" preload="auto"></audio>
  <audio id="audio-ng" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" preload="auto"></audio>
  <audio id="audio-pinpon" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" preload="auto"></audio>
  <script src="html5-qrcode.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
